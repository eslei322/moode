<?php
/**
 * moOde audio player (C) 2014 Tim Curtis
 * http://moodeaudio.org
 *
 * tsunamp player ui (C) 2013 Andrea Coiutti & Simone De Gregori
 * http://www.tsunamp.com
 *
 * This Program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3, or (at your option)
 * any later version.
 *
 * This Program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * 2020-04-24 TC moOde 6.5.0
 *
 */

require_once dirname(__FILE__).'/inc/playerlib.php';require_once dirname(__FILE__).'/inc/timezone.php';require_once dirname(__FILE__).'/inc/keyboard.php';playerSession('open','','');if(isset($_POST['checkfor_update'])){$available=checkForUpd($_SESSION['res_software_upd_url'].'/');$lastinstall=checkForUpd('/var/local/www/');if($available['Date']==$lastinstall['Date']){$_available_upd='系统已经是最新版<br>';}else{$_available_upd=$available['Date']=='取消'?$available['Date'].'<br>':'版本日期: '.$available['Date'].'<button class="btn btn-primary btn-small set-button btn-submit" id="install-update" type="submit" name="install_update" value="1">安装</button>'.'<button class="btn btn-primary btn-small set-button" data-toggle="modal" href="#view-pkgcontent">检视</button><br>'.'<span class="help-block-configs help-block-margin" style="margin-bottom:5px">Progress can be monitored via SSH cmd: moodeutl -t</span>';$_pkg_description=$available['Description'];$_pkg_relnotes=$available['Relnotes'];}}if(isset($_POST['install_update'])){if($_POST['install_update']==1){$mount=sysCmd('mount | grep "moode.sqsh"');$space=sysCmd("df | grep /dev/root | awk '{print $4}'");if($mount[0]!='/var/local/moode.sqsh on /var/www type squashfs (ro,relatime)'&&($_SESSION['feat_bitmask']&FEAT_SQSHCHK)){$_SESSION['notify']['title']='无效配置';$_SESSION['notify']['msg']="无法找到压缩文件系统";$_SESSION['notify']['duration']=20;}elseif($mount[0]=='/var/local/moode.sqsh on /var/www type squashfs (ro,relatime)'&&!($_SESSION['feat_bitmask']&FEAT_SQSHCHK)){$_SESSION['notify']['title']='无效配置';$_SESSION['notify']['msg']="压缩文件是只读";$_SESSION['notify']['duration']=20;}elseif($space[0]<512000){$_SESSION['notify']['title']='空间不足';$_SESSION['notify']['msg']="进行更新需要不少于 500M 的可用空间";$_SESSION['notify']['duration']=20;}else{submitJob('installupd','','新版软件已安装','系统需要重新启动',60);$_available_upd='软件已是最新版<br>';}}}if(isset($_POST['update_time_zone'])){if(isset($_POST['timezone'])&&$_POST['timezone']!=$_SESSION['timezone']){submitJob('timezone',$_POST['timezone'],'时区调整到 '.$_POST['timezone'],'');playerSession('write','timezone',$_POST['timezone']);}}if(isset($_POST['update_host_name'])){if(isset($_POST['hostname'])&&$_POST['hostname']!=$_SESSION['hostname']){if(preg_match("/[^A-Za-z0-9-]/",$_POST['hostname'])==1){$_SESSION['notify']['title']='无效字符';$_SESSION['notify']['msg']="主机名称只能包含 A-Z、a-Z、0-9 或连字符 （ - ）。";$_SESSION['notify']['duration']=3;}else{submitJob('hostname','"'.$_SESSION['hostname'].'" '.'"'.$_POST['hostname'].'"','主机名称已更新','系统需要重启');playerSession('write','hostname',$_POST['hostname']);}}}if(isset($_POST['update_keyboard'])){if(isset($_POST['keyboard'])&&$_POST['keyboard']!=$_SESSION['keyboard']){submitJob('keyboard',$_POST['keyboard'],'键盘布局已更新 ','系统需要重启');playerSession('write','keyboard',$_POST['keyboard']);}}if(isset($_POST['update_browser_title'])){if(isset($_POST['browsertitle'])&&$_POST['browsertitle']!=$_SESSION['browsertitle']){submitJob('browsertitle','"'.$_SESSION['browsertitle'].'" '.'"'.$_POST['browsertitle'].'"','浏览器名称已更新','浏览器需要刷新');playerSession('write','browsertitle',$_POST['browsertitle']);}}if(isset($_POST['update_cpugov'])){submitJob('cpugov',$_POST['cpugov'],'CPU 管控已更新','');playerSession('write','cpugov',$_POST['cpugov']);}if(isset($_POST['update_kernel_architecture'])){submitJob('kernel_architecture',$_POST['kernel_architecture'],$_POST['kernel_architecture'].' 内核架构已更新','系统需要重启');playerSession('write','kernel_architecture',$_POST['kernel_architecture']);}if(isset($_POST['update_usb_auto_mounter'])){submitJob('usb_auto_mounter',$_POST['usb_auto_mounter'],'USB 自动加载器已更新','系统需要重启');playerSession('write','usb_auto_mounter',$_POST['usb_auto_mounter']);}if(isset($_POST['p3wifi'])&&$_POST['p3wifi']!=$_SESSION['p3wifi']){$title=$_POST['p3wifi']==1?'启用 WiFi 适配器':'停用 WiFi 适配器';submitJob('p3wifi',$_POST['p3wifi'],$title,'系统需要重启');playerSession('write','p3wifi',$_POST['p3wifi']);}if(isset($_POST['p3bt'])&&$_POST['p3bt']!=$_SESSION['p3bt']){$title=$_POST['p3bt']==1?'启用蓝牙适配器':'停用蓝牙适配器';submitJob('p3bt',$_POST['p3bt'],$title,'系统需要重启');playerSession('write','p3bt',$_POST['p3bt']);}if(isset($_POST['hdmiport'])&&$_POST['hdmiport']!=$_SESSION['hdmiport']){$title=$_POST['hdmiport']==1?'启用 HDMI 端口':'停用 HDMI 端口';submitJob('hdmiport',$_POST['hdmiport'],$title,'');playerSession('write','hdmiport',$_POST['hdmiport']);}if(isset($_POST['update_actled'])&&$_POST['actled']!=explode(',',$_SESSION['led_state'])[0]){$title=$_POST['actled']=='1'?'动作指示灯点亮':'动作指示灯熄灭';submitJob('actled',$_POST['actled'],$title,'');playerSession('write','led_state',$_POST['actled'].','.explode(',',$_SESSION['led_state'])[1]);}if(isset($_POST['update_pwrled'])&&$_POST['pwrled']!=explode(',',$_SESSION['led_state'])[1]){$title=$_POST['pwrled']=='1'?'电源指示灯点亮':'电源指示灯熄灭';submitJob('pwrled',$_POST['pwrled'],$title,'');playerSession('write','led_state',explode(',',$_SESSION['led_state'])[0].','.$_POST['pwrled']);}if(isset($_POST['eth0chk'])&&$_POST['eth0chk']!=$_SESSION['eth0chk']){$_SESSION['notify']['title']=$_POST['eth0chk']==1?'启用检查 Eth0 IP':'停用检查 Eth0 IP';$_SESSION['notify']['msg']='系统需要重启';playerSession('write','eth0chk',$_POST['eth0chk']);}if(isset($_POST['maxusbcurrent'])&&$_POST['maxusbcurrent']!=$_SESSION['maxusbcurrent']){$title=$_POST['maxusbcurrent']==1?'启用 USB 2 倍电流':'停用 USB 2 倍电流';submitJob('maxusbcurrent',$_POST['maxusbcurrent'],$title,'系统需要重启');playerSession('write','maxusbcurrent',$_POST['maxusbcurrent']);}if(isset($_POST['update_uac2fix'])){if(isset($_POST['uac2fix'])&&$_POST['uac2fix']!=$_SESSION['uac2fix']){$title=$_POST['uac2fix']==1?'启用 USB ( UAC2 ) 修复':'停用 USB ( UAC2 ) 修复';submitJob('uac2fix',$_POST['uac2fix'],$title,'系统需要重启');playerSession('write','uac2fix',$_POST['uac2fix']);}}if(isset($_POST['update_eth_port_fix'])){if(isset($_POST['eth_port_fix'])&&$_POST['eth_port_fix']!=$_SESSION['eth_port_fix']){$_SESSION['notify']['title']=$_POST['eth_port_fix']==1?'启用固网端口修复':'停用固网端口修复';$_SESSION['notify']['msg']='系统需要重启';playerSession('write','eth_port_fix',$_POST['eth_port_fix']);}}if(isset($_POST['update_expand_rootfs'])){submitJob('expandrootfs','','系统所在分区已扩展','系统需要重启',30);}if(isset($_POST['update_usbboot'])){submitJob('usbboot','','USB 引导已激活','系统需要重启',30);}if(isset($_POST['update_localui'])){if(isset($_POST['localui'])&&$_POST['localui']!=$_SESSION['localui']){$title=$_POST['localui']==1?'启用本地 UI 显示':'停用本地 UI 显示';submitJob('localui',$_POST['localui'],$title,'Reboot may be required');playerSession('write','localui',$_POST['localui']);}}if(isset($_POST['update_touchscn'])){if(isset($_POST['touchscn'])&&$_POST['touchscn']!=$_SESSION['touchscn']){submitJob('touchscn',$_POST['touchscn'],'设置已更新','本地显示已重启');playerSession('write','touchscn',$_POST['touchscn']);}}if(isset($_POST['update_scnblank'])){if(isset($_POST['scnblank'])&&$_POST['scnblank']!=$_SESSION['scnblank']){submitJob('scnblank',$_POST['scnblank'],'设置已更新','本地显示已重启');playerSession('write','scnblank',$_POST['scnblank']);}}if(isset($_POST['update_wake_display'])){if(isset($_POST['wake_display'])&&$_POST['wake_display']!=$_SESSION['wake_display']){$_SESSION['notify']['title']=$_POST['wake_display']=='1'?'启用唤醒显示':'停用唤醒显示';playerSession('write','wake_display',$_POST['wake_display']);}}if(isset($_POST['update_scnbrightness'])){if(isset($_POST['scnbrightness'])&&$_POST['scnbrightness']!=$_SESSION['scnbrightness']){submitJob('scnbrightness',$_POST['scnbrightness'],'设置已更新');playerSession('write','scnbrightness',$_POST['scnbrightness']);}}if(isset($_POST['update_pixel_aspect_ratio'])){if(isset($_POST['pixel_aspect_ratio'])&&$_POST['pixel_aspect_ratio']!=$_SESSION['pixel_aspect_ratio']){submitJob('pixel_aspect_ratio',$_POST['pixel_aspect_ratio'],'设置已更新','系统需要重启');playerSession('write','pixel_aspect_ratio',$_POST['pixel_aspect_ratio']);}}if(isset($_POST['update_scnrotate'])){if(isset($_POST['scnrotate'])&&$_POST['scnrotate']!=$_SESSION['scnrotate']){submitJob('scnrotate',$_POST['scnrotate'],'设置已更新','系统需要重启');playerSession('write','scnrotate',$_POST['scnrotate']);}}if(isset($_POST['update_clear_browser_cache'])){submitJob('clearbrcache','','缓存已清除','本地用户界面浏览器需要刷新');}if(isset($_POST['extmeta'])&&$_POST['extmeta']!=$_SESSION['extmeta']){$_SESSION['notify']['title']=$_POST['extmeta']==1?'启用诠释资料文件':'停用诠释资料文件';$_SESSION['notify']['duration']=3;playerSession('write','extmeta',$_POST['extmeta']);}if(isset($_POST['update_lcdup'])){if(isset($_POST['lcdup'])&&$_POST['lcdup']!=$_SESSION['lcdup']){$title=$_POST['lcdup']==1?'启用 LCD 更新引擎':'停用 LCD 更新引擎';submitJob('lcdup',$_POST['lcdup'],$title,'');playerSession('write','lcdup',$_POST['lcdup']);playerSession('write','extmeta','1');}}if(isset($_POST['update_gpio_svc'])&&$_POST['gpio_svc']!=$_SESSION['gpio_svc']){$title=$_POST['gpio_svc']==1?'启用 GPIO 按钮管理器':'停用 GPIO 按钮管理器';playerSession('write','gpio_svc',$_POST['gpio_svc']);submitJob('gpio_svc',$_POST['gpio_svc'],$title,'');}if(isset($_POST['shellinabox'])&&$_POST['shellinabox']!=$_SESSION['shellinabox']){$title=$_POST['shellinabox']==1?'启用 SSH 服务器':'停用 SSH 服务器';playerSession('write','shellinabox',$_POST['shellinabox']);submitJob('shellinabox',$_POST['shellinabox'],$title,'');}if(isset($_POST['update_clear_syslogs'])){submitJob('clearsyslogs','','系统日志已清空','');}if(isset($_POST['update_clear_playhistory'])){submitJob('clearplayhistory','','回放历史记录已清空','');}if(isset($_POST['update_compactdb'])){submitJob('compactdb','','SQlite 数据库已压缩','');}if(isset($_POST['debuglog'])&&$_POST['debuglog']!=$_SESSION['debuglog']){$_SESSION['notify']['title']=$_POST['debuglog']==1?'启用调试记录':'停用调试注销';$_SESSION['notify']['duration']=3;playerSession('write','debuglog',$_POST['debuglog']);}session_write_close();$_timezone['timezone']=buildTimezoneSelect($_SESSION['timezone']);$_select['hostname']=$_SESSION['hostname'];$_keyboard['keyboard']=buildKeyboardSelect($_SESSION['keyboard']);$_select['browsertitle']=$_SESSION['browsertitle'];$_select['cpugov'].="<option value=\"ondemand\" ".(($_SESSION['cpugov']=='ondemand')?"selected":"").">按需求管理</option>\n";$_select['cpugov'].="<option value=\"performance\" ".(($_SESSION['cpugov']=='performance')?"selected":"").">按效能管理</option>\n";if($_SESSION['feat_bitmask']&FEAT_KERNEL){$_feat_kernel='';$_select['kernel_architecture'].="<option value=\"32-bit\" ".(($_SESSION['kernel_architecture']=='32-bit')?"selected":"").">32-bit</option>\n";$model=substr($_SESSION['hdwrrev'],3,1);$name=$_SESSION['hdwrrev'];if($name=='Pi-2B 1GB v1.2'||$model=='3'||$model=='4'){$_select['kernel_architecture'].="<option value=\"64-bit\" ".(($_SESSION['kernel_architecture']=='64-bit')?"selected":"").">64-bit</option>\n";}}else{$_feat_kernel='hide';}$_select['usb_auto_mounter'].="<option value=\"udisks-glue\" ".(($_SESSION['usb_auto_mounter']=='udisks-glue')?"selected":"").">Udisks-glue (Default)</option>\n";$_select['usb_auto_mounter'].="<option value=\"devmon\" ".(($_SESSION['usb_auto_mounter']=='devmon')?"selected":"").">Devmon</option>\n";$model=substr($_SESSION['hdwrrev'],3,1);$name=$_SESSION['hdwrrev'];if($name=='Pi-Zero W 512MB v1.1'||$model=='3'||$model=='4'){$_wifibt_hide='';$_select['p3wifi1'].="<input type=\"radio\" name=\"p3wifi\" id=\"togglep3wifi1\" value=\"1\" ".(($_SESSION['p3wifi']==1)?"checked=\"checked\"":"").">\n";$_select['p3wifi0'].="<input type=\"radio\" name=\"p3wifi\" id=\"togglep3wifi2\" value=\"0\" ".(($_SESSION['p3wifi']==0)?"checked=\"checked\"":"").">\n";$_select['p3bt1'].="<input type=\"radio\" name=\"p3bt\" id=\"togglep3bt1\" value=\"1\" ".(($_SESSION['p3bt']==1)?"checked=\"checked\"":"").">\n";$_select['p3bt0'].="<input type=\"radio\" name=\"p3bt\" id=\"togglep3bt2\" value=\"0\" ".(($_SESSION['p3bt']==0)?"checked=\"checked\"":"").">\n";}else{$_wifibt_hide='hide';}$_select['hdmiport1'].="<input type=\"radio\" name=\"hdmiport\" id=\"togglehdmiport1\" value=\"1\" ".(($_SESSION['hdmiport']==1)?"checked=\"checked\"":"").">\n";$_select['hdmiport0'].="<input type=\"radio\" name=\"hdmiport\" id=\"togglehdmiport2\" value=\"0\" ".(($_SESSION['hdmiport']==0)?"checked=\"checked\"":"").">\n";$actled=explode(',',$_SESSION['led_state'])[0];$_select['actled1'].="<input type=\"radio\" name=\"actled\" id=\"toggle_actled1\" value=\"1\" ".(($actled=='1')?"checked=\"checked\"":"").">\n";$_select['actled0'].="<input type=\"radio\" name=\"actled\" id=\"toggle_actled2\" value=\"0\" ".(($actled=='0')?"checked=\"checked\"":"").">\n";if(substr($_SESSION['hdwrrev'],0,7)=='Pi-Zero'||substr($_SESSION['hdwrrev'],3,1)=='1'||$_SESSION['hdwrrev']=='Allo USBridge SIG [CM3+ Lite 1GB v1.0]'){$_pwrled_hide='hide';}else{$_pwrled_hide='';$pwrled=explode(',',$_SESSION['led_state'])[1];$_select['pwrled1'].="<input type=\"radio\" name=\"pwrled\" id=\"toggle_pwrled1\" value=\"1\" ".(($pwrled=='1')?"checked=\"checked\"":"").">\n";$_select['pwrled0'].="<input type=\"radio\" name=\"pwrled\" id=\"toggle_pwrled2\" value=\"0\" ".(($pwrled=='0')?"checked=\"checked\"":"").">\n";}$_select['eth0chk1'].="<input type=\"radio\" name=\"eth0chk\" id=\"toggleeth0chk1\" value=\"1\" ".(($_SESSION['eth0chk']==1)?"checked=\"checked\"":"").">\n";$_select['eth0chk0'].="<input type=\"radio\" name=\"eth0chk\" id=\"toggleeth0chk2\" value=\"0\" ".(($_SESSION['eth0chk']==0)?"checked=\"checked\"":"").">\n";$model=substr($_SESSION['hdwrrev'],3,1);if($model=='1'||$model=='2'){$_maxcurrent_hide='';$_select['maxusbcurrent1'].="<input type=\"radio\" name=\"maxusbcurrent\" id=\"togglemaxusbcurrent1\" value=\"1\" ".(($_SESSION['maxusbcurrent']==1)?"checked=\"checked\"":"").">\n";$_select['maxusbcurrent0'].="<input type=\"radio\" name=\"maxusbcurrent\" id=\"togglemaxusbcurrent2\" value=\"0\" ".(($_SESSION['maxusbcurrent']==0)?"checked=\"checked\"":"").">\n";}else{$_maxcurrent_hide='hide';}$_select['uac2fix1'].="<input type=\"radio\" name=\"uac2fix\" id=\"toggleuac2fix1\" value=\"1\" ".(($_SESSION['uac2fix']==1)?"checked=\"checked\"":"").">\n";$_select['uac2fix0'].="<input type=\"radio\" name=\"uac2fix\" id=\"toggleuac2fix2\" value=\"0\" ".(($_SESSION['uac2fix']==0)?"checked=\"checked\"":"").">\n";if(substr($_SESSION['hdwrrev'],0,6)=='Pi-3B+'){$_eth_port_fix_hide='';$_select['eth_port_fix1']="<input type=\"radio\" name=\"eth_port_fix\" id=\"toggle_eth_port_fix0\" value=\"1\" ".(($_SESSION['eth_port_fix']=='1')?"checked=\"checked\"":"").">\n";$_select['eth_port_fix0']="<input type=\"radio\" name=\"eth_port_fix\" id=\"toggle_eth_port_fix1\" value=\"0\" ".(($_SESSION['eth_port_fix']=='0')?"checked=\"checked\"":"").">\n";}else{$_eth_port_fix_hide='hide';}$result=sysCmd('grep "add2home_off" /var/local/www/header.php');$_select['add2home1'].="<input type=\"radio\" name=\"add2home\" id=\"toggleadd2home1\" value=\"1\" ".((empty($result[0]))?"checked=\"checked\"":"").">\n";$_select['add2home0'].="<input type=\"radio\" name=\"add2home\" id=\"toggleadd2home2\" value=\"0\" ".((!empty($result[0]))?"checked=\"checked\"":"").">\n";$_select['expandrootfs1'].="<input type=\"radio\" name=\"expandrootfs\" id=\"toggleexpandrootfs1\" value=\"1\" ".">\n";$_select['expandrootfs0'].="<input type=\"radio\" name=\"expandrootfs\" id=\"toggleexpandrootfs2\" value=\"0\" "."checked=\"checked\"".">\n";$result=sysCmd("df | grep root | awk '{print $2}'");$_expandrootfs_msg=$result[0]>3500000?'文件系统已扩展':'文件系统未扩展';$model=substr($_SESSION['hdwrrev'],3,1);if($model=='3'){$_usbboot_hide='';$_select['usbboot1'].="<input type=\"radio\" name=\"usbboot\" id=\"toggleusbboot1\" value=\"1\" ".">\n";$_select['usbboot0'].="<input type=\"radio\" name=\"usbboot\" id=\"toggleusbboot2\" value=\"0\" "."checked=\"checked\"".">\n";$result=sysCmd('vcgencmd otp_dump | grep 17:');$_usbboot_msg=$result[0]=='17:3020000a'?'USB 引导功能已激活':'USB 引导功能未激活';}else{$_usbboot_hide='hide';}if($_SESSION['feat_bitmask']&FEAT_LOCALUI){$_feat_localui='';$_select['localui1'].="<input type=\"radio\" name=\"localui\" id=\"togglelocalui1\" value=\"1\" ".(($_SESSION['localui']==1)?"checked=\"checked\"":"").">\n";$_select['localui0'].="<input type=\"radio\" name=\"localui\" id=\"togglelocalui2\" value=\"0\" ".(($_SESSION['localui']==0)?"checked=\"checked\"":"").">\n";$_select['touchscn1'].="<input type=\"radio\" name=\"touchscn\" id=\"toggletouchscn1\" value=\"1\" ".(($_SESSION['touchscn']==1)?"checked=\"checked\"":"").">\n";$_select['touchscn0'].="<input type=\"radio\" name=\"touchscn\" id=\"toggletouchscn2\" value=\"0\" ".(($_SESSION['touchscn']==0)?"checked=\"checked\"":"").">\n";$_select['wake_display1'].="<input type=\"radio\" name=\"wake_display\" id=\"toggle_wake_display1\" value=\"1\" ".(($_SESSION['wake_display']==1)?"checked=\"checked\"":"").">\n";$_select['wake_display0'].="<input type=\"radio\" name=\"wake_display\" id=\"toggle_wake_display2\" value=\"0\" ".(($_SESSION['wake_display']==0)?"checked=\"checked\"":"").">\n";$_select['scnblank'].="<option value=\"off\" ".(($_SESSION['scnblank']=='off')?"selected":"").">停用屏幕保护</option>\n";$_select['scnblank'].="<option value=\"10\" ".(($_SESSION['scnblank']=='10')?"selected":"").">10 Secs</option>\n";$_select['scnblank'].="<option value=\"20\" ".(($_SESSION['scnblank']=='20')?"selected":"").">20 Secs</option>\n";$_select['scnblank'].="<option value=\"30\" ".(($_SESSION['scnblank']=='30')?"selected":"").">30 Secs</option>\n";$_select['scnblank'].="<option value=\"60\" ".(($_SESSION['scnblank']=='60')?"selected":"").">1 Min</option>\n";$_select['scnblank'].="<option value=\"120\" ".(($_SESSION['scnblank']=='120')?"selected":"").">2 Mins</option>\n";$_select['scnblank'].="<option value=\"300\" ".(($_SESSION['scnblank']=='300')?"selected":"").">5 Mins</option>\n";$_select['scnblank'].="<option value=\"600\" ".(($_SESSION['scnblank']=='600')?"selected":"").">10 Mins</option>\n";$_select['scnblank'].="<option value=\"1200\" ".(($_SESSION['scnblank']=='1200')?"selected":"").">20 Mins</option>\n";$_select['scnblank'].="<option value=\"1800\" ".(($_SESSION['scnblank']=='1800')?"selected":"").">30 Mins</option>\n";$_select['scnblank'].="<option value=\"3600\" ".(($_SESSION['scnblank']=='3600')?"selected":"").">1 Hour</option>\n";$_select['scnbrightness']=$_SESSION['scnbrightness'];$_select['pixel_aspect_ratio'].="<option value=\"Default\" ".(($_SESSION['pixel_aspect_ratio']=='Default')?"selected":"").">默认</option>\n";$_select['pixel_aspect_ratio'].="<option value=\"Square\" ".(($_SESSION['pixel_aspect_ratio']=='Square')?"selected":"").">正方形</option>\n";$_select['scnrotate'].="<option value=\"0\" ".(($_SESSION['scnrotate']=='0')?"selected":"").">0 度</option>\n";$_select['scnrotate'].="<option value=\"180\" ".(($_SESSION['scnrotate']=='180')?"selected":"").">180 度</option>\n";}else{$_feat_localui='hide';}$_select['extmeta1'].="<input type=\"radio\" name=\"extmeta\" id=\"toggleextmeta1\" value=\"1\" ".(($_SESSION['extmeta']==1)?"checked=\"checked\"":"").">\n";$_select['extmeta0'].="<input type=\"radio\" name=\"extmeta\" id=\"toggleextmeta2\" value=\"0\" ".(($_SESSION['extmeta']==0)?"checked=\"checked\"":"").">\n";$_select['lcdup1'].="<input type=\"radio\" name=\"lcdup\" id=\"togglelcdup1\" value=\"1\" ".(($_SESSION['lcdup']==1)?"checked=\"checked\"":"").">\n";$_select['lcdup0'].="<input type=\"radio\" name=\"lcdup\" id=\"togglelcdup2\" value=\"0\" ".(($_SESSION['lcdup']==0)?"checked=\"checked\"":"").">\n";if($_SESSION['feat_bitmask']&FEAT_GPIO){$_feat_gpio='';$_select['gpio_svc1'].="<input type=\"radio\" name=\"gpio_svc\" id=\"toggle_gpio_svc1\" value=\"1\" ".(($_SESSION['gpio_svc']==1)?"checked=\"checked\"":"").">\n";$_select['gpio_svc0'].="<input type=\"radio\" name=\"gpio_svc\" id=\"toggle_gpio_svc2\" value=\"0\" ".(($_SESSION['gpio_svc']==0)?"checked=\"checked\"":"").">\n";}else{$_feat_gpio='hide';}$_select['shellinabox1'].="<input type=\"radio\" name=\"shellinabox\" id=\"toggleshellinabox1\" value=\"1\" ".(($_SESSION['shellinabox']==1)?"checked=\"checked\"":"").">\n";$_select['shellinabox0'].="<input type=\"radio\" name=\"shellinabox\" id=\"toggleshellinabox2\" value=\"0\" ".(($_SESSION['shellinabox']==0)?"checked=\"checked\"":"").">\n";$_select['hostip']=getHostIp();if($_SESSION['shellinabox']=='1'){$_ssh_btn_disable='';$_ssh_link_disable='';}else{$_ssh_btn_disable='disabled';$_ssh_link_disable='onclick="return false;"';}$_select['debuglog1'].="<input type=\"radio\" name=\"debuglog\" id=\"toggledebuglog1\" value=\"1\" ".(($_SESSION['debuglog']==1)?"checked=\"checked\"":"").">\n";$_select['debuglog0'].="<input type=\"radio\" name=\"debuglog\" id=\"toggledebuglog2\" value=\"0\" ".(($_SESSION['debuglog']==0)?"checked=\"checked\"":"").">\n";waitWorker(1,'sys-config');$tpl="sys-config.html";$section=basename(__FILE__,'.php');storeBackLink($section,$tpl);include('/var/local/www/header.php');eval("echoTemplate(\"".getTemplate("templates/$tpl")."\");");include('footer.php');
